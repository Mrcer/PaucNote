# 关系
## 关系的基本概念
### 集合的笛卡尔积
* （定义6.1）定义**有序对**$\langle a,b\rangle$为集合$\{a,\{a,b\}\}$
* （定义6.2）定义**笛卡尔积**$A\times B=\{\langle a,b\rangle\mid a\in A\wedge b\in B\}$
* 笛卡尔积不满足交换律和结合律，对集合交和并运算满足分配律
* 可以递归定义得到**n元组**：当n=2时就是有序对定义，当n>2时定义为$\langle\langle a_1,...a_{n-1}\rangle,a_n\rangle$
* 类似地，两个集合的笛卡尔积可推广到n个集合的笛卡尔积；特别地，n个相同集合的笛卡尔积简记为集合的n次幂
### 关系的定义
* （定义6.3）集合A到B的**二元关系**R定义为笛卡尔积$A\times B$的子集。特别地，当A=B时称R为**集合A上的二元关系**
* 空集称为**空关系**，整个笛卡尔积称为**全关系**，$\Delta_A=\{\langle a,a\rangle\mid a\in A\}$称为**恒等关系**或**对角关系**
### 关系的表示
* 关系图  
    有向图，指向出发顶点的彼岸称为环
* 关系矩阵  
    若$R\subseteq A\times B$，且A有n个元素，B有k个元素，则关系矩阵是一个n行k列的矩阵，其中第i行第j列元素$m_{ij}$等于1当且仅当$\langle a_i, b_j\rangle\in R$
### 关系的运算
* （定义6.4）设R是集合A到B的关系，它的**逆关系**，记为$R^{-1}$，是集合B到A的关系，定义为：$R^{-1}=\{\langle b,a\rangle\mid\langle a,b\rangle\in R\}$
* （定理6.5）设R是集合A到B的关系，S是集合B到C的关系，则R和S的**复合**，记为$S\circ R$，是集合A到C的关系，定义为：
   $S\circ R=\{\langle a,c\rangle\mid\exists b\in B(\langle a,b\rangle\in R\wedge\langle b,c\rangle\in S)\}$
> 这种类似函数的记法称为**逆序复合**，还有另一种从左到右运算的**顺序复合**。
* 关系的并交差运算相当于对集合进行运算
* 可以借助关系矩阵完成关系运算，并交差就相当于对关系矩阵对应元素进行或与和半减（只有1逻辑减0才能得到1，否则为零），求逆就是关系矩阵转置，复合$S\circ R$就是关系矩阵的矩阵逻辑积$M_R \odot M_S$（加用或代替，乘用与代替）
* （定理6.3）求逆运算的性质
    1. $(R^{-1})^{-1}=R$
    2. 若$R\subseteq S$，则$R^{-1}\subseteq S^{-1}$
    3. $(R\cup S)^{-1}=R^{-1}\cup S^{-1},\ (R\cap S)^{-1}=R^{-1}\cap S^{-1}$
> 如果先进行$op_1$再进行$op_2$和先进行$op_2$再进行$op_1$结果相同，则称$op_1$和$op_2$是具有**可交换性的**。可以说并和求逆，交和求逆都是可交换的
* （定理6.4）复合运算的性质
    1. $T\circ(S\circ R)=(T\circ S)\circ R$
    2. $\Delta_B\circ R=R=R\circ \Delta_A$
* （定理6.5）关系复合保持子集关系，即，若$R\subseteq S$且$U\subseteq W$，则$U\circ R\subseteq W\circ S$
* （定理6.6）$(S\circ R)^{-1}=R^{-1}\circ S^{-1}$
* （定理6.7）  
    （1） 关系复合对集合并有分配律，即

    $$T\circ(R\cup S)=(T\circ R)\cup(T\circ S)$$

    $$\ (R\cup S)\circ T=(R\circ T)\cup(S\circ T)$$

    （2） 关系复合对集合交**没有**分配律，但是有

    $$T\circ(R\cap S)\subseteq(T\circ R)\cap(T\circ S)$$

    $$\ (R\cap S)\circ T\subseteq(R\circ T)\cap(S\circ T)$$

## 关系的性质
### 关系的自反性和反自反性
* （定义6.6）设R是集合A上的关系，即$R\subseteq A\times A$
    1. 称R是**自反的**，如果对任意$a\in A$都有$\langle a,a\rangle \in R$
    2. 称R是**反自反的**，如果对任意$a\in A$都有$\langle a,a\rangle\not\in R$
* 存在既不是自反的也不是反自反的关系，但除了空集外自反和反自反性质是互斥的
* 从关系图来看，自反关系的关系图每个顶点都有环，反自反关系的每个顶点都没有环
* 从关系矩阵来看，自反关系的关系矩阵对角线都为1，反自反关系的关系矩阵的对角线都为0
* （定理6.8）设R是集合A上的关系，则：
    1. R是自反的当且仅当$\Delta_A\subseteq R$
    2. R是反自反的当且仅当$\Delta_A\cap R=\varnothing$
### 关系的对称性和反对称性
* （定义6.7）设R是集合A上的关系，即$R\subseteq A\times A$
    1. 称R是**对称的**，若对任意$a,b\in A,\langle a,b\rangle \in R$蕴含$\langle b,a\rangle\in R$
    2. 称R是**反对称的**，若对任意$a,b\in A,\langle a,b\rangle\in R$且$\langle b,a\rangle\in R$蕴含$a=b$
* 对称性和反对称性并不互斥，也存在既不是对称的也不是反对称的关系
* 从关系图来看，对称关系的关系图等价于无向图，而反对称关系的关系图中任意两个顶点间最多只有一条直接相连的边
* 从关系矩阵来看，对称关系的关系矩阵是对称矩阵，反对称关系的关系矩阵中不存在对角线外关于对角线对称的1
* （定理6.9）设R是集合A上的关系，则：
    1. R是对称的当且仅当$R=R^{-1}$
    2. R是反对称的当且仅当$R\cap R^{-1}\subseteq\Delta_A$
### 关系的传递性
* （定义6.8）设R是集合A上的关系，即$R\subseteq A\times A$。说R是**传递的**，如果对任意$a,b,c\in A,\langle a,b\rangle\in R$且$\langle b,c\rangle\in R$蕴含$\langle a,c\rangle\in R$，即R是传递的，当且仅当$\forall a\in A\forall b\in A\forall c\in A(\langle a,b\rangle\in R\wedge \langle b,c\rangle\in R\to \langle a,c\rangle\in R)$
* 从关系图来看，传递关系的关系图的任意两个顶点之间如果有长度大于或等于2的有向通路，则他们之间就有直接的有向边
* （定理6.10）设R是集合A上的关系。R是传递的当且仅当$R\circ R\subseteq R$
### 关系性质与关系运算
* 以上性质给出的定义属于元素考察法定义，对应的定理也可以定义这些性质，称为性质概括法定义
* 下面表给出：若参与运算的关系都有列对应的性质，那么运算结果是否也有列对应的性质：

|运算| 自反性 |反自反性|对称性|反对称性|传递性|
|--|--|--|--|--|--|
| 关系逆运算|是|是|是|是|是|
|集合交运算|是|是|是|是|是|
|集合并运算|是|是|是|否|否|
|集合差运算|否|是|是|是|否|
|关系复合运算|是|否|否|否|否|

## 关系的闭包
简单来说，关系的闭包就是*包含一个关系*且*满足某个性质*的*最小*关系
### 关系闭包的定义
* （定义6.9）设R是非空集合A上的关系，R的**自反闭包**$r(R)$是同时满足下面条件的A上的关系
    * $R\subseteq r(R)$
    * $r(R)$是自反关系
    * 对于任意自反关系S，若$R\subseteq S$，则$r(R)\subseteq S$

    **对称闭包**$s(R)$，**传递闭包**$t(R)$定义过程同理
    > 上面个条件与闭包的直观定义中的三个性质是一一对应的，并且第三条可用于证明关系闭包是另一个关系的子集。在闭包的讨论中，约定参与运算的关系都是包含于$A\times A$，其中$A$都是非空的（为了排除平凡情况），下面的阐述中我就省掉了哈

* （定理6.11）$R$是自反的当且仅当$r(R)=R$；$R$是对称的当且仅当$s(R)=R$；$R$是传递的当且仅当$t(R)=R$。
   > 也就是说已满足某种性质的关系的该性质闭包就是这个关系本身
* （定理6.12）若$R\subseteq S$，则：$r(R)\subseteq r(S)$；$s(R)\subseteq s(S)$；$t(R)\subseteq t(S)$
   > 闭包保持子集关系
* 自反闭包和集合并、对称闭包和集合并都满足可交换性，但$t(R)\cup t(S)\subseteq t(R\cup S)$，$t(t(R)\cup t(S))=t(R\cup S)$
   > 不要求掌握。另外对集合交和自反闭包、对称闭包的交换性，可以用下面的闭包计算过程结合关系矩阵很容易得出结论
### 关系闭包的计算
* （定理6.13）$r(R)=R\cup\Delta_A$
* （定理6.14）$s(R)=R\cup R^{-1}$  
   接下来都是讨论传递闭包的计算的QAQ

* （定义6.10）关系$R$的$n(n\ge 1)$次幂$R^n$定义为：
    $R^n=\left\{\begin{array}{l}R&,n=1\\R^{n-1}\circ R&,n\ge 2\end{array}\right.$

* （引理6.15）$R^m\circ R^n=R^{m+n}$
* （定理6.16）$t(R)=R^*=\bigcup_{n=1}^\infty R^n$
   > 直观来看第k次复合能找到距离为k的有向通路，因此实际上只需求n次（集合A中的元素数量）就可以啦！这样就可以将求传递闭包转化为求复合运算，进而转化为矩阵运算。具体来说需要进行的逻辑运算是$O(n^4)$的，下面的Warshall法可以优化到$O(n^3)$
* （Warshall算法）考虑$R$的关系图，其中有$n$个顶点，编号为$\{v_1,\cdots,v_n\}$，定义$W_k=\{w_{ij}^{[k]}\}$，其中$w_{ij}^{[k]}$等于1当且仅当顶点$v_i$和$v_j$之间存在中间顶点全部在顶点集$\{v_1,\cdots,v_k\}$中的有向通路，特别地，$W_0=M_R$。可以证明$w_{ij}^{[k]}=w_{ij}^{[k-1]}\vee(w_{ik}^{[k-1]}\wedge w_{kj}^{[k-1]})$，如此迭代运算n次得到的$W_n$就是$t(R)$的关系矩阵啦！
## 特殊关系举例
### 等价关系
* （定义6.11）设R是非空集合A上的关系，如果R是自反的、对称的和传递的关系，则称R为**等价关系**
* （定义6.12）设R是非空集合A上的等价关系。
    1. 元素$a\in A$所在的等价关系R的**等价类**，简称a的等价类，记为$[a]_R$，是所有与a有关系R的元素构成的集合，即
    $[a]_R=\{x\in A\mid\langle a,x\rangle\in R\}$
    2. 对元素$b\in A$，若$b\in [a]_R$，则称b为等价类$[a]_R$的一个**代表**，特别地，a是$[a]_R$的一个代表，即总有$a\in [a]_R$（因为等价关系R是自反关系）
    3. 集合A的所有元素的等价类构成的集合称为称为集合A关于等价关系R的**商集**，记为A/R，即
    $A/R=\{[a]_R\mid a\in A\}$
* （引理6.17）设R是非空集A上的等价关系，对任意$a,b\in A$：
    1. $[a]_R=[b]_R$当且仅当$\langle a,b\rangle\in R$
    2. $[a]_R\cap[b]_R=\varnothing$当且仅当$\langle a,b\rangle\not\in R$
* （定理6.18）设$R$是非空集$A$上的等价关系
    1. $\forall a\in A，[a]_R\neq\varnothing$
    2. 对任意$a,b\in A$，要么$[a]_R=[b]_R$，要么$[a]_R\cap[b]_R=\varnothing$
    3. 所有等价类的广义并等于$A$，即$\bigcup_{a\in A}[a]_R=A$，也即$\bigcup A/R=A$
* （定义6.13）设$A$是一个非空集合，$F$是一个集合族，其中的每个几何都是$A$的子集。说集合族$F$是$A$的**划分**，如果它满足：
    1. $F$中的集合均不为空集
    2. $F$中的任意两个集合交集为空
    3. $F$的广义并是A
并称$F$中的每个集合是这个划分的一个**划分块**
* （定理6.19）非空集合A上的等价关系与它的划分有一一对应关系，即：A关于一个等价关系的商集是A的划分；A的一个划分所导出的“在同一划分块”关系是等价关系。
### 偏序关系
* （定义6.14）设R是非空集A上的关系，如果R是自反的、反对称的和传递的关系，则称R为**偏序关系**，通常简称偏序关系R为偏序，用符号$\preceq$表示

    > 另外，也称反自反且传递的关系为**严格序**，严格序必然是反对称的

* （定义6.15）若$\preceq$是非空集A上的偏序关系，则称$(A,\preceq)$是**偏序集**。在上下文明确的情况下（例如，我们总是将A的偏序记为$\preceq$），直接称A是偏序集
    
    > 偏序集就像内积空间，本质上还是集合A，只不过在其上定义了偏序关系
     
    对A的任意两个元素a,b，若有$a\preceq b$或$b\preceq a$，则称a和b是**可比的**，否则就是**不可比**的。如果A中的任意两个元素都可比，则称A为**全序**或**线序**
    对A的任意两个元素a,b，若$a\preceq b$，则称a **小于或等于** b，也称b **大于或等于** a。若$a\preceq b$且$a\neq b$，则称a **小于** b，也称b **大于** a。
    对A的任意两个元素a,b，若$a\preceq b$，且不存在c使得$a\preceq c$且$c\preceq b$，则称b**覆盖**a

* 偏序图可以用**哈斯图**来描述。哈斯图是一种简化的关系图，从关系图出发，简化过程如下：
    1. 去掉环
    2. 去掉非覆盖关系的边
    3. 调整顶点位置，使得覆盖元素总在被覆盖元素上方，并将有向边绘制为无向边

* （定义6.16）设$(A,\preceq)$是偏序集。
    1. a是A的**极大元**当且仅当$\forall b\in A(a\preceq b \to b=a)$
    2. a是A的**极小元**当且仅当$\forall b\in A(b\preceq a \to b=a)$
    3. a是A的**最大元**当且仅当$\forall b\in A(b\preceq a)$
    4. a是A的**最小元**当且仅当$\forall b\in A(a\preceq b)$
    > “极”不要求和所有元素都可比，“最”则要求和所有元素都可比

* （定理6.20）对于偏序集$(A,\preceq)$，设$a\in A$
    1. 若a是A的最大元/最小元，则a也是A的极大元/极小元
    2. 若A是全序的，且a是A的极小元/极大元，则a也是A的最大元/最小元

* （定理6.21）最大元和最小元存在则唯一
* （定义6.17）设$(A,\preceq)$是偏序集，$a\in A, S\subseteq A$。
    1. a是S的**上界**当且仅当$\forall b\in S(b\preceq a)$（a大于等于S中的任意元素）
    2. a是S的**下界**当且仅当$\forall b\in S(a\preceq b)$
    3. a是S的**上确界**当且仅当a是S的上界的最小元
    4. a是S的**下确界**当且仅当a是S的下界的最大元

* （定理6.22）上确界和下确界存在则唯一