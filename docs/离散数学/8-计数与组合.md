# 计数和组合
## 组合计数的基本原理
### 加减乘除
* 记集合S的元素数量为|S|
* （定义8.1）**加法原理**：若集合S有划分$F=\{S_1,\cdots S_n$，则

$$|S|=|S_1|+\cdots+|S_n|$$

> 不重不漏地分类，简化元素数量运算
* （定义8.2）**乘法原理**：若集合S的每个元素都是个元素构成的序列（n元组）$\langle s_1,\cdots,s_n\rangle$，每个元素$s_i$的可，能取值有$m_i$种，且对任意$i< n$无论$s_i$取$m_i$种值的哪个值，$s_{i+1}$都有$m_{i+1}$种可能的取值，则

$$\mid A_1\times\cdots\times A_n\mid =m_1\times\cdots\times m_n$$

!!! note
        注意满足乘法原理的集合，序列前一个元素与后一个元素既有一定**独立性**又可能有一定**相关性**，也就是说前一个元素选择不同，后一个元素可选的值可能不同（相关性），但可选值的数量一定相同（独立性）
!!! note
        应用乘法原理划分任务应优先考虑约束条件多的子任务，并保证后续任务的完成方法数不依赖于这个任务的完成方法

* （定义8,3）**减法原理**：对于全集U
和他的子集S，有

$$|S|=|U|-|\bar S|=|U|-|U-S|$$

* （定义8.4）**除法原理**：若集合S和集合T之间存在满函数$f:S\to T$，且T的每个元素在f下都恰好有k个原像，则

$$|T|=|S|/k$$

* （定义8.5）**一一对应原理**：如果有限集合S和集合T之间存在双函数，这他们有相同的元素个数
> 我觉得这是个定理。。
### 容斥原理
以下集合都默认为有穷集合

* （引理8.1）$|A-B|=|A|-|A\cap B|$
* （定理8.2）**两集合容斥原理**：

$$|A\cup B|=|A|+|B|-|A\cap B|$$

* （推论8.3）**三集合容斥原理**：

$$|A\cup B\cup C|=|A|+|B|+|C|-|A\cap B|-|A\cap C|-|B\cap C|+|A\cap B\cap C|$$

> 三集合容斥原理推导的基本思路是将$A\cup B$看作一个集合来运用两集合容斥原理展开，更多集合的容斥原理可以以此类推
### 鸽笼原理
* （定理8.4）**鸽笼原理**或**抽屉原理**：设k是正整数，将k＋1或更多只鸽子关到k个鸽笼里，至少有一个鸽笼里有两个或更多只鸽子

* （推论8.5）设A和B都是有穷集合
    * 若$|A|>|B|$，则没有A到B的单函数
    * 若$|A|<|B|$，则没有A到B的满函数
    * 若$|A|＝|B|$，则任意A到B的单函数或满函数也是双函数

* （定理8.6）**广义鸽笼原理**：将N个舞台放到k个盒子，则至少有一个盒子至少有$\lceil N/k\rceil$个物体
* 拉姆齐定理
## 排列与组合
* （定义8.6）从n个可区别的物体*不允许重复*地选择r个物体进行*有序*安排，称为n个物体的r-**排列**。如果n个物体构成集合S，也成为S的r-排列。S的n-排列称为**全排列**。我们用$P^r_n$或$P(n,r)$表示S的r-排列数。
* （定理8.7）  

$$P(n,r)=\frac{n!}{(n-r)!}=n(n-1)\cdots (n-r+1)$$

* （定义8.6）从n个可区别的物体*不允许重复*、*不计顺序*地选择r个物体，称为n个物体的r **组合**。如果n个物体构成集合S，也成为S的r组合。S的r组合数记为$C_n^r$或$C(n,r)$。组合数$C(n,r)$也称为**二项式系数**，这时通常记为$\binom{n}{r}$
* 可以将组合数$C(n,r)$理解为n元素集合的r子集数，这种理解方式称为**集合论解释**；也可以理解为长度为n且含r个1的二进制串数，称为**二进制串解释**。组合数学中等式可以通过论证等式两边是对同一个集合元素的不同计数方式来证明，这称为**双计数证明**，也可以论证他们分别是对两个有一一映射关系的集合的计数，这成为**双函数证明**，这两种证明方法称为**组合证明**。等式也可以用更严谨代数法证明，称为**代数证明**
* （定理8.8）**组合数的对称式** 

$$C(n,r)=C(n,n-r),r\leq n$$

* （引理8.9）$r<n$

$$(r+1)C(n,r+1)=(n-r)C(n,r)$$

* （定理8.10）$r\leq n$

$$C(n,r)=\frac{P(n,r)}{P(r,r)}=\frac{n!}{r!(n-r)!}$$

### 二项式定理与组合等式
* （定理8.11）**二项式定理**：设x,y是两个变量，n是正整数，则：

$$\begin{align}(x+y)^n=&\sum_{i=0}^n\binom{n}{i}x^iy^{n-i}\\=&\binom{n}{0}y^n+\binom{n}{1}y^{n-1}+\cdots+\binom{n}{n}x^n\end{align}$$


* 二项式定理常见的代入展开式：
    * $当y=1时,(x+1)^n=\binom{n}{0}+\binom{n}{1}x+\cdots+\binom{n}{n}x^n$
    * $当x=1,y=1时,\binom{n}{0}+\binom{n}{1}+\cdots+\binom{n}{n}=2^n$
    * $当x=-1,y=1时,\binom{n}{0}+\binom{n}{2}+\binom{n}{4}+\cdots=\binom{n}{1}+\binom{n}{3}+\binom{n}{5}+\cdots=2^{n-1}$
    * $当x=2,y=1时,\binom{n}{0}+\binom{n}{1}x+\cdots+\binom{n}{n}x^n=3^n$
    * $令y=1后对式子微分得n(1+x)^{n-1}=\binom{n}{1}+2\binom{n}{2}x+\cdots+n\binom{n}{n}x^{n-1}$

* （定理8.12）**帕斯卡等式**设n,k是自然数，且$1\leq k\leq n-1$，有：

$$\binom{n}{k}=\binom{n-1}{k}+\binom{n-1}{k-1}$$

* 常用组合等式：
    * **递推式**:$r\binom{n}{r}=(n-r+1)\binom{n}{r-1}=n\binom{n-1}{r-1},1\leq r\leq n$
    * **乘积化简式**：$\binom{n}{m}\binom{m}{k}=\binom{n}{k}\binom{n-k}{m-k},k\leq m\leq n$
    * **上下求和式**：  
        $\sum_{k=0}^r\binom{m+k}{k}=\binom{m}{0}+\binom{m+1}{1}+\cdots+\binom{m+r}{r}=\binom{m+r+1}{r}$  
        $\sum_{k=0}^n\binom{k}{m}=\binom{0}{m}+\binom{1}{m}+\cdots+\binom{n}{m}=\binom{n+1}{m+1}$ 
    * **朱世杰-范德蒙等式**：$\sum_{k=0}^r\binom{m}{r-k}\binom{n}{k}=\binom{m+n}{r},r\leq m,r\leq n$

### 允许重复的排列与组合

* （定理8.13）n类物体允许重复的r排列数是$n^r$
* （定理8.14）每类物体分别有$m_1,m_2,\cdots,m_n$个的n类物体允许重复的$m_1+m_2\cdots+m_n=r$排列数是

$$C(r,m_1)C(r-m_1,m_2)\cdots C(r-m_1-m_2-\cdots-m_{n-1},m_n)=\frac{r!}{m_1!m_2!\cdots m_n!}$$

* （定理8.15）物体个数不限的n类物体允许重复地选r个物体的方案数，等于长度为n-1+r且有r个1的二进制串个数，等于$C(n-1+r,r)$

!!! note
    原理是问题可转化为解不定方程$x_1+x2+\cdots+x_n=r$的非负整数解，而这与长度为n-1+r且有r个1的二进制串一一对应

### 再论容斥原理及其应用
* （定理8.16）**一般形式的容斥原理**：

$$|\bigcup_{i=0}^n A_i|=\sum_{k=1}^n\left( (-1)^{k-1}\sum_{1\leq i_1\leq \cdots \leq i_k\leq n}|\bigcap A_i|\right)$$

* （推论8.17）

$$N(\bar{P_1}\cdots\bar{P_n})=N+\sum_{k=1}^n\left( (-1)^k\sum_{1\leq i_1\leq \cdots \leq i_k\leq n}N(P_{i_1}\cdots P_{i_k})\right)$$

* 不定方程变种的化归方法：
	1. 若$x_i$有下界$a_i$，即$x_i\geq a_i$，则令$X_i=x_i-a_i$，代入原不定方程即可消除下界（将下界变为0）
	2. 若$x_i$有上界$b_i$，即$x_i\leq b_i$则令$P_i=x_i\geq b_i+1$，则原问题化为求$N(\bar{P_1}\cdots\bar{P_n})$
	3. 若问题是不等式，则引入新变量使其变为等式

### 排列与组合的生成算法

* （定义8.8）**字典序**：一般情况下，看作符合用`strcmp()`定义的升序序列即可

* （引理8.18）对于一个长度固定、确定前缀的字符串，前缀后字符是降序排列的字符串字典序最大，前缀后字符是升序排列的字符串字典序最小

* 计算全排列串$a$的下一个串的算法：
	1. 从末尾往前找最长的降序序列$a_ia{i+1}\cdots a_n$
	2. 找该序列中大于该序列前一字符$a_{i-1}$的最小值，交换他们；由于序列降序，实际上就是从后往前找第一个大于$a_{i-1}$的字符。
	3. 将该序列变为升序；不难证明这只需要将这个序列反转即可

* 计算n元素r组合时一个串$a$的下一个串；由于组合是无序的，为了将组合映射到有序的串，规定这些串应当是升序的；为了方便讨论，将这些串的字符用正整数表示。
	1. 显然最大的串为$(n-r+1)\cdots n$，于是先从右往左找到第一个不等于最大串对应位置字符的字符，也就是从右往左找第一个满足$a_i\neq n-r+i$的下标$i$
	2. 将$a_i$加一，往后的每一个字符都变为前一字符加一，比如变化后$a_i=5$，则从$a_i$开始往后就是$5678\cdots$

## 递推关系式

### 技术问题的递推关系式建模

* （定义8.9）**递推关系式**是用序列中某些前面的项表示第n想的等式。如果$\{a_n\}$满足一个递推关系式，则称这个序列为他的**解**；如果这个解序列的第n项能使用不含序列中任意项的通项公式表达，则称这个公式为递推关系式的**封闭公式解**
* 为了得到一个问题的递推关系式，需要使用分治思想，将大问题拆成小问题，再逐个解决小问题；可以用集合语言简化叙述

### 线性递推关系式求解

* **线性**指递推式是乘式的和，每个乘式至多含一个序列前项；**齐次**表示所有项都与序列前项相关；**常系数**表示多项式系数与n无关
* （定理8.19）对于一个常系数k阶线性齐次递推关系式

$$
a_n=c_1a_{n-1}+c_2a_{n-2}+\cdots+c_k+a_{n-k}
$$

其中$c_1,c_2,\cdots,c_k$w为实数，且$c_k\neq 0$。方程

$$
x^k=c_1x^{k-1}+c_2x^{k-2}+\cdots+c_k
$$

称为该递推关系式的**特征方程**。如果这个方程有k个互不相同的根$r_1,r_2,\cdots,r_k$，则序列$\{a_n\}$是该递推关系式的解当且仅当：

$$
a_n=\beta_1r_1^n+\beta_2r_2^n+\cdots+\beta_kr_k^n
$$

其中$\beta_1,\beta_2,\cdots,\beta_k$是常数，称为这个解的**待定系数**，可由递推关系式的k个初始条件，即序列$\{a_n\}$的k个初值确定

* （定理8.20）如果特征方程有重根，设有t个不同的根$r_1,r_2,\cdots,r_t$，每个根对应的重数为$m_1,m_2,\cdots,m_t$，则序列$\{a_n\}$是该递推关系式的解当且仅当：

$$
a_n=\sum_{i=1}^n \sum_{j=1}^{m_i}\beta_{i,j}r_i^n
$$

* 对于一个常系数k阶线性非齐次递推关系式$a_n=c_1a_{n-1}+c_2a_{n-2}+\cdots+c_k+a_{n-k}+F(n)$，记它的**伴随齐次递推关系式**为$a_n=c_1a_{n-1}+c_2a_{n-2}+\cdots+c_k+a_{n-k}$。要求解非齐次方程，先解不考虑初值条件下伴随齐次递推关系式的解，称为**特解**。

* （定理8.21）如果$\{a_n^{(p)}\}$是一个常系数阶线性非齐次递推关系式的特解，那么它的每个解都具有形式$\{a_n^{(p)}+a_n^{(h)}\}$，其中$\{a_n^{(h)}\}$是它的伴随齐次递推关系式的一个解