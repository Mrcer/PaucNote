# 计算机系统总线
## 总线概述
计算机系统是由多个基本模块连接而成的，可以把这些部件、模块、甚至计算机系统称为**节点**，节点的连接方式称为**拓扑结构**。拓扑结构有很多种，总线是最常用的一种拓扑结构，也被称为广播式网络。

总线结构有一条主要通路称总线，各个部件接入总线来交换数据，其具有低成本和多功能的特点，性能主要受限于总线长度和节点数。按照应用总线结构的部分分为芯片总线、系统总线和通信总线等，本章介绍的系统总线（下简称总线）负责连接CPU、主存和其他I/O设备。

总线分为单总线结构和多总线结构。单总线是直接应用总线拓扑结构，由于不同部件速度不同，性能较差。多总线结构分出多条总线，不同总线以不同速度运行以协调快慢设备速度。以奔腾4为例，将慢速I/O设备用I/O总线连接起来，通过南桥汇总作为一个高速设备，将其与内存、显卡等高速设备用北桥汇总起来连接到CPU。

总线包括地址线、数据线和控制线。单个时刻只能有一对设备占用总线，因此需要通过仲裁来获取使用权。按仲裁设备分类，负责仲裁的设备就称为总线主设备，其他设备称为总线从设备。按传输方向分类，发送数据的设备称为总线源设备，接受数据的设备称为总线目标设备。按访问方法分类，有存储器设备和I/O设备

总线设备使用总线的过程：

1. 设备发起请求，控制器仲裁
2. 总线控制器应答，设备寻址
3. 设备数据传输
4. 传输完成，撤销请求和应答

总线的标准包括物理特性（尺寸）、电气特性（电平范围）、功能特性（管脚定义）、时间特性（时序）等

## 总线设计

1. 信号线类型
	专用信号线设计中，地址和数据用不同信号线传输；复用设计中，地址和数据用相同信号线，在不同周期传输（时分复用）
2. 仲裁方式：
	* 集中式仲裁只有一个控制器，如CPU
	* 分布式仲裁有多个控制器，如南北桥
	* 串行总线仲裁，即将设备按优先级串行连接，当总线空闲时依次传递空闲信号，先获得信号且需要占用总线的设备获得使用权——这样的优先权是固定的
	* 并行总线仲裁，每个设备根据总线是否空闲和高优先级设备是否在请求来决定是否使用总线。这种方式也是固定优先级，但并联方式相对串联可以防止单个设备损坏导致的系统崩溃
	* 冲突检测方式仲裁，设备要使用总线时先检查总线是否空闲，空闲则使用总线。使用总线时监听总线，如果两个设备同时使用则发生冲突，各自停止随机时间后再尝试。一般用于网络通信，如Ethernet总线。
3. 定时方式
	总线上各个事务的协同方式可以分为同步和异步。同步总线中所有设备使用统一时钟，按预定的时序完成事务；异步总线采用握手机制，设备以信号而非周期为准进行事务。同步通常用在距离短、速度一致设备的交流，如CPU内部总线；异步通常用在速度差异大的设备间通讯。还有一种半同步方式：主设备发送时钟信号，从设备发送状态信号，主设备在获知从设备就绪后开始接受数据，这样效率较高。而分离方式是一种优化方式，将地址和数据分开传输，从接收完地址到准备好数据之间的时间释放总线，从而提高总线利用率。
4. 事务类型
	分为存储器读写、I/O读写、读指令、中断等
5. 总线宽度、总线频率、总线带宽
	带宽=宽度x频率

总线数据传输可以采用分组传输式，也就是输入一个地址输出多个地址的数据。
